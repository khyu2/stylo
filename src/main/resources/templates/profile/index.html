<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{layout/base}">
<head>
    <title>프로필 - Stylo</title>
</head>
<body>
<div layout:fragment="content">
    <div class="min-h-screen p-8">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Flash Messages -->
            <div th:if="${success}" class="alert alert-success mb-6">
                <i data-lucide="check-circle" class="w-5 h-5"></i>
                <span th:text="${success}"></span>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
                <!-- Sidebar -->
                <div class="lg:col-span-1">
                    <div class="card bg-base-100 border border-gray-200 shadow-sm">
                        <div class="card-body">
                            <!-- 프로필 이미지 -->
                            <div class="text-center mb-6">
                                <div class="relative inline-block">
                                    <div class="avatar">
                                        <div class="w-20 h-20 lg:w-24 lg:h-24 rounded-full">
                                            <img th:id="profileImage"
                                                 th:src="${#authentication.principal.profileUrl != null ? #authentication.principal.profileUrl : '/images/default_profile.jpeg'}"
                                                 alt="프로필 사진">
                                        </div>
                                    </div>
                                    <!-- Camera Button -->
                                    <button type="button" onclick="document.getElementById('profileImageInput').click()"
                                            class="btn btn-circle btn-sm btn-primary absolute -bottom-1 -right-1">
                                        <i data-lucide="camera" class="w-3 h-3"></i>
                                    </button>
                                    <!-- Delete Button -->
                                    <button type="button" onclick="deleteProfileImage()"
                                            class="btn btn-circle btn-sm btn-error absolute -bottom-1 -right-6"
                                            th:if="${#authentication.principal.profileUrl != null}">
                                        <i data-lucide="trash-2" class="w-3 h-3"></i>
                                    </button>
                                    <!-- Hidden forms for file upload and delete -->
                                    <form id="uploadForm" action="/profile/upload-profile-image" method="post"
                                          enctype="multipart/form-data" class="hidden">
                                        <input type="file" id="profileImageInput" name="image" accept="image/*"
                                               onchange="uploadProfileImage(event)">
                                    </form>
                                    <form id="deleteForm" action="/profile/delete-profile-image" method="post"
                                          class="hidden"></form>
                                </div>
                                <h3 class="mt-3 text-base lg:text-lg font-semibold"
                                    sec:authentication="principal.member.name">사용자명</h3>
                                <p class="text-sm opacity-70" sec:authentication="principal.member.email">
                                    user@example.com</p>
                            </div>

                            <!-- Navigation -->
                            <ul class="menu bg-base-100 rounded-box w-full">
                                <li>
                                    <button onclick="switchTab('profile')" data-tab-button="profile"
                                            class="w-full text-left">
                                        <i data-lucide="user" class="w-4 h-4 mr-2"></i>
                                        개인정보
                                    </button>
                                </li>
                                <li>
                                    <button onclick="switchTab('address')" data-tab-button="address"
                                            class="w-full text-left">
                                        <i data-lucide="map-pin" class="w-4 h-4 mr-2"></i>
                                        배송지 관리
                                    </button>
                                </li>
                                <li>
                                    <button onclick="switchTab('security')" data-tab-button="security"
                                            class="w-full text-left">
                                        <i data-lucide="shield" class="w-4 h-4 mr-2"></i>
                                        보안 설정
                                    </button>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Main Content -->
                <div class="lg:col-span-3">
                    <!-- 개인정보 -->
                    <div data-tab="profile" class="card bg-base-100 border border-gray-200 shadow-sm p-4">
                        <div class="card-header m-4">
                            <h2 class="card-title">개인정보</h2>
                            <p class="text-sm opacity-70">기본적인 개인정보를 수정할 수 있습니다</p>
                        </div>
                        <div class="card-body">
                            <form th:action="@{/profile/update}" method="post" class="space-y-6">
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                                    <fieldset class="fieldset form-control">
                                        <label for="email" class="label fieldset-legend">
                                            <span class="label-text">이메일</span>
                                        </label>
                                        <input type="email" id="email" name="email" disabled
                                               th:value="${member.email}"
                                               class="input input-bordered bg-base-200">
                                    </fieldset>
                                    <fieldset class="fieldset form-control">
                                        <label for="name" class="label fieldset-legend">
                                            <span class="label-text">이름</span>
                                        </label>
                                        <input type="text" id="name" name="name"
                                               th:value="${member.name}"
                                               class="input input-bordered">
                                    </fieldset>
                                    <fieldset class="fieldset form-control">
                                        <label for="tel" class="label fieldset-legend">
                                            <span class="label-text">연락처</span>
                                        </label>
                                        <input type="text" id="tel" name="phone"
                                               th:value="${member.phone}"
                                               class="input input-bordered">
                                    </fieldset>
                                </div>

                                <!-- 마케팅 수신 동의 -->
                                <div class="divider"></div>
                                <div>
                                    <h3 class="text-lg font-medium mb-4">마케팅 정보 수신</h3>
                                    <div class="form-control">
                                        <label class="cursor-pointer flex items-center">
                                            <span>
                                                <div class="font-medium">마케팅 정보 수신 동의</div>
                                                <div class="text-sm opacity-70">새로운 상품, 할인 정보, 이벤트 소식을 이메일과 SMS로 받아보세요.</div>
                                            </span>
                                            <input type="checkbox" id="isMarketing" name="isMarketing"
                                                   th:checked="${member.isMarketing}"
                                                   class="checkbox checkbox-primary ml-4">
                                        </label>
                                    </div>
                                </div>

                                <div class="flex justify-end">
                                    <button type="submit" class="btn btn-primary">
                                        정보 수정
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- 배송지 관리 -->
                    <div data-tab="address" class="card bg-base-100 border border-gray-200 shadow-sm p-4"
                         style="display: none;">
                        <div class="card-header m-4">
                            <div class="flex flex-col sm:flex-row sm:justify-between sm:items-center gap-4">
                                <div>
                                    <h2 class="card-title">배송지 관리</h2>
                                    <p class="text-sm opacity-70">배송지를 추가하고 관리할 수 있습니다</p>
                                </div>
                                <button onclick="openAddressModal()" class="btn btn-primary btn-sm">
                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                    배송지 추가
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <!-- 배송지가 없는 경우 -->
                            <div th:if="${#lists.isEmpty(addresses)}" class="text-center py-8">
                                <i data-lucide="map-pin" class="w-12 h-12 opacity-40 mx-auto mb-4"></i>
                                <p class="opacity-70 mb-4">등록된 배송지가 없습니다.</p>
                                <button onclick="openAddressModal()" class="btn btn-primary">
                                    <i data-lucide="plus" class="w-4 h-4"></i>
                                    첫 번째 배송지 추가
                                </button>
                            </div>

                            <!-- 배송지 목록 -->
                            <div th:if="${!#lists.isEmpty(addresses)}" class="space-y-4">
                                <div th:each="address : ${addresses}"
                                     th:classappend="${address.defaultAddress} ? 'bg-base-200' : ''"
                                     class="card bg-base-100">
                                    <div class="card-body p-4">
                                        <div class="flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4">
                                            <div class="flex-1">
                                                <div class="flex items-center mb-2">
                                                    <span th:if="${address.defaultAddress}"
                                                          class="badge badge-primary badge-sm mr-2">기본</span>
                                                    <span class="font-medium" th:text="${address.recipient}">수령인</span>
                                                </div>
                                                <p class="text-sm opacity-70 mb-1" th:text="${address.phone}">연락처</p>
                                                <p class="text-sm opacity-70 mb-1">
                                                    <span th:text="${address.address}">주소</span>
                                                    <span th:if="${address.addressDetail != null}"
                                                          th:text="', ' + ${address.addressDetail}">상세주소</span>
                                                    <span th:text="' (우편번호: ' + ${address.postalCode} + ')'">우편번호</span>
                                                </p>
                                                <p class="text-sm opacity-70" th:if="${address.requestMessage}"
                                                   th:text="${'요청사항 : ' + address.requestMessage}">요청사항</p>
                                            </div>
                                            <div class="flex space-x-2">
                                                <!-- 기본 배송지인 경우 별표 아이콘 표시 -->
                                                <button th:if="${address.defaultAddress}"
                                                        class="btn btn-ghost btn-sm text-warning"
                                                        title="기본 배송지로 설정">
                                                    <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                                </button>
                                                <!-- 기본 배송지가 아닌 경우 기본 배송지 설정 버튼 표시 -->
                                                <button th:unless="${address.defaultAddress}"
                                                        th:onclick="'setDefaultAddress(' + ${address.addressId} + ')'"
                                                        class="btn btn-ghost btn-sm text-base-content hover:text-success"
                                                        title="기본 배송지로 설정">
                                                    <i data-lucide="star" class="w-4 h-4"></i>
                                                </button>
                                                <button th:onclick="'editAddress(' + ${address.addressId} + ')'"
                                                        class="btn btn-ghost btn-sm text-base-content hover:text-primary">
                                                    <i data-lucide="edit" class="w-4 h-4"></i>
                                                </button>
                                                <button th:onclick="'deleteAddress(' + ${address.addressId} + ')'"
                                                        class="btn btn-ghost btn-sm text-base-content hover:text-error">
                                                    <i data-lucide="trash-2" class="w-4 h-4"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 보안 설정 -->
                    <div data-tab="security" class="card bg-base-100 border border-gray-200 shadow-sm p-4"
                         style="display: none;">
                        <div class="card-header m-4">
                            <h2 class="card-title">보안 설정</h2>
                            <p class="text-sm opacity-70">비밀번호 변경 및 보안 설정을 관리합니다</p>
                        </div>
                        <div class="card-body">
                            <form th:action="@{/profile/change-password}" method="post" class="space-y-6"
                                  id="passwordForm" onsubmit="validatePasswordForm(event)">

                                <!-- 현재 비밀번호 -->
                                <fieldset class="fieldset form-control">
                                    <label for="currentPassword" class="label fieldset-legend">
                                        <span class="label-text">현재 비밀번호</span>
                                    </label>
                                    <input type="password" id="currentPassword" name="currentPassword" required
                                           class="input input-bordered">
                                </fieldset>

                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4 lg:gap-6">
                                    <fieldset class="fieldset form-control">
                                        <label for="newPassword" class="label fieldset-legend">
                                            <span class="label-text">새 비밀번호</span>
                                        </label>
                                        <input type="password" id="newPassword" name="newPassword" required
                                               class="input input-bordered">
                                        <span class="label">8자 이상 20자 이하로 입력해주세요.</span>
                                    </fieldset>

                                    <fieldset class="fieldset form-control">
                                        <label for="confirmPassword" class="label fieldset-legend">
                                            <span class="label-text">비밀번호 확인</span>
                                        </label>
                                        <input type="password" id="confirmPassword" name="confirmPassword" required
                                               class="input input-bordered" oninput="checkPasswordMatch()">
                                        <label id="passwordMismatch" class="label" style="display: none;">
                                            <span class="label-text-alt text-error">비밀번호가 일치하지 않습니다.</span>
                                        </label>
                                    </fieldset>
                                </div>

                                <div class="flex justify-end">
                                    <button type="submit" class="btn btn-primary">
                                        비밀번호 변경
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Address Modal -->
    <div id="addressModal" class="modal">
        <div class="modal-box max-w-2xl bg-gradient-to-br from-base-100 to-base-200 shadow-2xl">
            <!-- Modal Header -->
            <div class="flex items-center gap-3 mb-6 pb-4 border-b border-base-300">
                <div class="w-10 h-10 bg-primary text-primary-content rounded-full flex items-center justify-center">
                    <i data-lucide="map-pin" class="w-5 h-5"></i>
                </div>
                <div>
                    <h3 class="font-bold text-xl text-base-content" id="modalTitle">배송지 추가</h3>
                    <p class="text-sm opacity-70">배송지 정보를 입력해주세요</p>
                </div>
            </div>

            <form id="addressForm" action="/profile/address" method="post" class="space-y-6"
                  th:object="${addressRequest}">

                <!-- 수령인 정보 -->
                <fieldset class="fieldset bg-base-100 rounded-lg border border-base-300 shadow-sm">
                    <legend class="fieldset-legend flex items-center gap-2">
                        <i data-lucide="user" class="w-4 h-4 text-primary"></i>
                        <span>수령인 정보</span>
                    </legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 p-4">
                        <div class="form-control">
                            <label for="recipient" class="label">
                                <span class="label-text font-medium">수령인</span>
                            </label>
                            <div class="relative">
                                <input type="text" id="recipient" th:field="*{recipient}" required
                                       class="input input-bordered w-full pl-10 focus:input-primary transition-all duration-200"
                                       placeholder="수령인 이름을 입력하세요">
                                <i data-lucide="user"
                                   class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 opacity-50"></i>
                            </div>
                        </div>
                        <div class="form-control">
                            <label for="phone" class="label">
                                <span class="label-text font-medium">연락처</span>
                            </label>
                            <div class="relative">
                                <input type="tel" id="phone" th:field="*{phone}" required
                                       class="input input-bordered w-full pl-10 focus:input-primary transition-all duration-200"
                                       placeholder="010-0000-0000">
                                <i data-lucide="phone"
                                   class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 opacity-50"></i>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <!-- 주소 정보 -->
                <fieldset class="fieldset bg-base-100 rounded-lg border border-base-300 shadow-sm">
                    <legend class="fieldset-legend flex items-center gap-2">
                        <i data-lucide="home" class="w-4 h-4 text-primary"></i>
                        <span>주소 정보</span>
                    </legend>
                    <div class="space-y-4 p-4">
                        <div class="form-control">
                            <label for="postalCode" class="label">
                                <span class="label-text font-medium">우편번호</span>
                            </label>
                            <div class="flex space-x-2">
                                <div class="relative flex-1">
                                    <input type="text" id="postalCode" th:field="*{postalCode}" required
                                           class="input input-bordered w-full pl-10 focus:input-primary transition-all duration-200"
                                           placeholder="우편번호를 입력하세요">
                                    <i data-lucide="hash"
                                       class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 opacity-50"></i>
                                </div>
                                <button type="button"
                                        class="btn btn-outline btn-primary hover:btn-primary transition-all duration-200">
                                    <i data-lucide="search" class="w-4 h-4 mr-1"></i>
                                    검색
                                </button>
                            </div>
                        </div>
                        <div class="form-control">
                            <label for="address" class="label">
                                <span class="label-text font-medium">기본주소</span>
                            </label>
                            <div class="relative">
                                <input type="text" id="address" th:field="*{address}" required
                                       class="input input-bordered w-full pl-10 focus:input-primary transition-all duration-200"
                                       placeholder="기본주소를 입력하세요">
                                <i data-lucide="map-pin"
                                   class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 opacity-50"></i>
                            </div>
                        </div>
                        <div class="form-control">
                            <label for="addressDetail" class="label">
                                <span class="label-text font-medium">상세주소</span>
                                <span class="label-text-alt opacity-60">(선택사항)</span>
                            </label>
                            <div class="relative">
                                <input type="text" id="addressDetail" th:field="*{addressDetail}"
                                       class="input input-bordered w-full pl-10 focus:input-primary transition-all duration-200"
                                       placeholder="상세주소를 입력하세요">
                                <i data-lucide="building"
                                   class="w-4 h-4 absolute left-3 top-1/2 transform -translate-y-1/2 opacity-50"></i>
                            </div>
                        </div>
                        <div class="form-control">
                            <label for="requestMessage" class="label">
                                <span class="label-text font-medium">요청사항</span>
                                <span class="label-text-alt opacity-60">(선택사항)</span>
                            </label>
                            <div class="relative">
                                <textarea rows="4" id="requestMessage" th:field="*{requestMessage}"
                                          class="textarea w-full focus:input-primary transition-all duration-200"
                                          placeholder="요청사항을 입력하세요"></textarea>
                            </div>
                        </div>
                    </div>
                </fieldset>

                <!-- 배송지 설정 -->
                <fieldset class="fieldset bg-base-100 rounded-lg border border-base-300 shadow-sm">
                    <legend class="fieldset-legend flex items-center gap-2">
                        <i data-lucide="settings" class="w-4 h-4 text-primary"></i>
                        <span>배송지 설정</span>
                    </legend>
                    <div class="p-4">
                        <div class="form-control">
                            <label class="label cursor-pointer hover:bg-base-200 rounded-lg p-3 transition-all duration-200">
                                <div class="flex items-center gap-3">
                                    <i data-lucide="star" class="w-5 h-5 text-warning"></i>
                                    <div>
                                        <span class="label-text font-medium">기본 배송지로 설정</span>
                                        <div class="text-xs opacity-60">이 배송지를 기본 배송지로 사용합니다</div>
                                    </div>
                                </div>
                                <input type="checkbox" id="defaultAddress" th:field="*{defaultAddress}"
                                       class="checkbox checkbox-primary checkbox-lg">
                            </label>
                        </div>
                    </div>
                </fieldset>

                <!-- Modal Actions -->
                <div class="modal-action pt-4 border-t border-base-300">
                    <button type="button" onclick="closeAddressModal()"
                            class="btn btn-ghost transition-all duration-200">
                        <i data-lucide="x" class="w-4 h-4 mr-1"></i>
                        취소
                    </button>
                    <button type="submit" class="btn btn-primary hover:btn-primary-focus transition-all duration-200">
                        <i data-lucide="save" class="w-4 h-4 mr-1"></i>
                        <span id="submitButtonText">저장</span>
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Error Modal -->
    <div id="errorModal" class="modal">
        <div class="modal-box">
            <div class="flex items-center gap-3 mb-4">
                <i data-lucide="alert-circle" class="w-6 h-6 text-error"></i>
                <h3 class="font-bold text-lg">오류</h3>
            </div>
            <p id="errorMessage" class="mb-6"></p>
            <div class="modal-action">
                <button onclick="closeErrorModal()" class="btn btn-primary">확인</button>
            </div>
        </div>
    </div>

    <!-- Confirm Modal -->
    <div id="confirmModal" class="modal">
        <div class="modal-box">
            <div class="flex items-center gap-3 mb-4">
                <i data-lucide="help-circle" class="w-6 h-6 text-warning"></i>
                <h3 class="font-bold text-lg">확인</h3>
            </div>
            <p id="confirmMessage" class="mb-6"></p>
            <div class="modal-action">
                <button onclick="closeConfirmModal()" class="btn">취소</button>
                <button onclick="confirmAction()" class="btn btn-primary">확인</button>
            </div>
        </div>
    </div>
</div>

<script layout:fragment="scripts" th:inline="javascript">
    const addresses = /*[[${addresses}]]*/ [];

    // 탭 전환 함수
    function switchTab(tabName) {
        // 모든 탭 내용 숨기기
        document.querySelectorAll('[data-tab]').forEach(tab => {
            tab.style.display = 'none';
        });

        // 선택된 탭 내용 보이기
        const selectedTab = document.querySelector(`[data-tab="${tabName}"]`);
        if (selectedTab) {
            selectedTab.style.display = 'block';
        }

        // 탭 버튼 스타일 업데이트
        document.querySelectorAll('[data-tab-button]').forEach(button => {
            button.classList.remove('active', 'bg-primary', 'text-primary-content');
            button.classList.add('hover:bg-base-200');
        });

        const selectedButton = document.querySelector(`[data-tab-button="${tabName}"]`);
        if (selectedButton) {
            selectedButton.classList.add('active', 'bg-primary', 'text-primary-content');
            selectedButton.classList.remove('hover:bg-base-200');
        }
    }

    // 배송지 모달 관련 함수들
    function openAddressModal() {
        document.getElementById('addressModal').classList.add('modal-open');
        resetAddressForm();
    }

    function closeAddressModal() {
        document.getElementById('addressModal').classList.remove('modal-open');
        resetAddressForm();
    }

    function resetAddressForm() {
        document.getElementById('addressForm').reset();
        document.getElementById('modalTitle').textContent = '배송지 추가';
        document.getElementById('addressForm').action = '/profile/address';
        document.getElementById('submitButtonText').textContent = '저장';
    }

    function editAddress(addressId) {
        const address = addresses.find(addr => addr.addressId === addressId);

        if (address) {
            // 폼 필드에 값 설정
            document.getElementById('recipient').value = address.recipient;
            document.getElementById('phone').value = address.phone;
            document.getElementById('postalCode').value = address.postalCode;
            document.getElementById('address').value = address.address;
            document.getElementById('addressDetail').value = address.addressDetail || '';
            document.getElementById('defaultAddress').checked = address.defaultAddress;

            // 모달 제목과 액션 변경
            document.getElementById('modalTitle').textContent = '배송지 수정';
            document.getElementById('addressForm').action = `/profile/address/update/${addressId}`;
            document.getElementById('submitButtonText').textContent = '수정';

            // 모달 열기
            document.getElementById('addressModal').classList.add('modal-open');
        }
    }

    function setDefaultAddress(addressId) {
        showConfirmModal('이 배송지를 기본 배송지로 설정하시겠습니까?', function () {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/profile/address/default/${addressId}`;
            document.body.appendChild(form);
            form.submit();
        });
    }

    function deleteAddress(addressId) {
        showConfirmModal('이 배송지를 삭제하시겠습니까?', function () {
            const form = document.createElement('form');
            form.method = 'POST';
            form.action = `/profile/address/delete/${addressId}`;
            document.body.appendChild(form);
            form.submit();
        });
    }

    // 비밀번호 확인 함수
    function checkPasswordMatch() {
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;
        const mismatchElement = document.getElementById('passwordMismatch');

        if (confirmPassword && newPassword !== confirmPassword) {
            mismatchElement.style.display = 'block';
        } else {
            mismatchElement.style.display = 'none';
        }
    }

    function validatePasswordForm(event) {
        const newPassword = document.getElementById('newPassword').value;
        const confirmPassword = document.getElementById('confirmPassword').value;

        if (newPassword !== confirmPassword) {
            event.preventDefault();
            showErrorModal('비밀번호가 일치하지 않습니다.');
            return false;
        }

        return true;
    }

    // 프로필 이미지 관련 함수들
    function uploadProfileImage(event) {
        const file = event.target.files[0];
        if (!file) {
            showErrorModal('파일을 선택해주세요.');
            return;
        }

        // 파일 크기 체크 (5MB 제한)
        if (file.size > 5 * 1024 * 1024) {
            showErrorModal('파일 크기는 5MB 이하여야 합니다.');
            return;
        }

        // 파일 타입 체크
        if (!file.type.startsWith('image/')) {
            showErrorModal('이미지 파일만 업로드 가능합니다.');
            return;
        }

        document.getElementById('uploadForm').submit();
    }

    function deleteProfileImage() {
        showConfirmModal('프로필 사진을 삭제하시겠습니까?', function () {
            document.getElementById('deleteForm').submit();
        });
    }

    // 오류 모달 관련 함수들
    function showErrorModal(message) {
        document.getElementById('errorMessage').textContent = message;
        document.getElementById('errorModal').classList.add('modal-open');
    }

    function closeErrorModal() {
        document.getElementById('errorModal').classList.remove('modal-open');
    }

    // 확인 모달 관련 함수들
    let confirmCallback = null;

    function showConfirmModal(message, callback) {
        document.getElementById('confirmMessage').textContent = message;
        confirmCallback = callback;
        document.getElementById('confirmModal').classList.add('modal-open');
    }

    function closeConfirmModal() {
        document.getElementById('confirmModal').classList.remove('modal-open');
        confirmCallback = null;
    }

    function confirmAction() {
        if (confirmCallback) {
            confirmCallback();
        }
        closeConfirmModal();
    }

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function () {
        // 기본 탭 설정
        switchTab('profile');

        // 서버에서 전달된 오류가 있으면 모달로 표시
        const errorMessage = /*[[${error}]]*/ null;
        if (errorMessage) {
            showErrorModal(errorMessage);
        }

        // 모달 외부 클릭 시 닫기
        document.getElementById('addressModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeAddressModal();
            }
        });

        document.getElementById('errorModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeErrorModal();
            }
        });

        document.getElementById('confirmModal').addEventListener('click', function (e) {
            if (e.target === this) {
                closeConfirmModal();
            }
        });

        // ESC 키로 모달 닫기
        document.addEventListener('keydown', function (e) {
            if (e.key === 'Escape') {
                closeAddressModal();
                closeErrorModal();
                closeConfirmModal();
            }
        });
    });
</script>
</body>
</html>
