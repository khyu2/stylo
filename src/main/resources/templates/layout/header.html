<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ko">
<head>
    <meta charset="UTF-8">
</head>
<body>
<nav th:fragment="header" class="navbar bg-base-100 shadow-sm border-b border-base-300">
    <div class="navbar-start">
        <!-- Logo -->
        <a href="/" class="p-4 text-xl font-bold text-primary">
            Stylo
        </a>
    </div>

    <div class="navbar-end">
        <!-- Cart -->
        <div class="dropdown dropdown-end" sec:authorize="isAuthenticated()">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
                <div class="indicator">
                    <i data-lucide="shopping-cart" class="h-5 w-5"></i>
                    <span th:if="${cartItemCount > 0}"
                          th:text="${cartItemCount}"
                          class="badge badge-sm indicator-item badge-primary">
                    </span>
                </div>
            </div>
            <div tabindex="0" class="mt-3 z-[1] card card-compact dropdown-content w-52 bg-base-100 shadow">
                <div class="card-body">
                    <span class="font-bold text-lg">장바구니</span>
                    <span class="text-info">상품이 담겨있습니다</span>
                    <div class="card-actions">
                        <a href="/cart" class="btn btn-primary btn-block">장바구니 보기</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Menu (Guest) -->
        <div sec:authorize="isAnonymous()" class="flex items-center gap-2 ml-4">
            <a href="/login" class="btn btn-outline btn-sm">로그인</a>
            <a href="/register" class="btn btn-primary btn-sm">회원가입</a>
        </div>

        <!-- User Menu (Logged in) -->
        <div sec:authorize="isAuthenticated()" class="dropdown dropdown-end select-none">
            <div tabindex="0" class="flex items-center gap-2 px-4 py-2 rounded-lg cursor-pointer">
                <div class="avatar mr-2">
                    <div class="w-10 rounded-full">
                        <img th:id="profileImage"
                             th:with="p=${#authentication.principal},isOidc=${p instanceof T(org.springframework.security.oauth2.core.oidc.user.OidcUser)},isOauth2=${p instanceof T(org.springframework.security.oauth2.core.user.OAuth2User)},isMember=${p instanceof T(project.stylo.auth.service.dto.MemberDetails)},pic=${isMember}? ${p.profileUrl} : (${isOidc}? ${p.getAttribute('picture')} : (${isOauth2}? ${p.getAttribute('profile_image_url')} : null))"
                             th:src="${pic != null ? pic : '/images/default_profile.jpeg'}"
                             alt="프로필 사진" />
                    </div>
                </div>
                <span th:text="${#authentication.principal instanceof T(project.stylo.auth.service.dto.MemberDetails) ? #authentication.principal.member.name : (#authentication.principal instanceof T(org.springframework.security.oauth2.core.oidc.user.OidcUser) ? #authentication.principal.getAttribute('name') : (#authentication.principal instanceof T(org.springframework.security.oauth2.core.user.OAuth2User) ? #authentication.principal.getAttribute('nickname') : '사용자'))}">사용자</span>님
                <i data-lucide="chevron-down" class="h-4 w-4"></i>
            </div>
            <ul tabindex="0" class="menu dropdown-content mt-3 z-[1] p-2 shadow bg-white rounded-box w-52">
                <li><a href="/profile"><i data-lucide="user" class="h-4 w-4"></i>프로필</a></li>
                <li><a href="/orders"><i data-lucide="shopping-bag" class="h-4 w-4"></i>주문 내역</a></li>
                <li><a href="/wishlist"><i data-lucide="heart" class="h-4 w-4"></i>위시리스트</a></li>
                <!-- Admin Menu -->
                <div sec:authorize="hasRole('ADMIN')">
                    <li>
                        <a href="/admin" class="text-primary">
                            <i data-lucide="settings" class="h-4 w-4"></i>
                            관리자 페이지
                        </a>
                    </li>
                </div>
                
                <li><a href="/logout" class="text-error"><i data-lucide="log-out" class="h-4 w-4"></i>로그아웃</a></li>
            </ul>
        </div>
    </div>
</nav>
</body>
</html>
