<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security" lang="ko">
<head>
    <meta charset="UTF-8">
</head>
<body>
<nav th:fragment="header" class="navbar bg-base-100 shadow-sm border-b border-base-300">
    <div class="navbar-start">
        <!-- Logo -->
        <a href="/" class="btn btn-ghost text-xl font-bold text-primary">
            Stylo
        </a>
    </div>

    <div class="navbar-end">
        <!-- Cart -->
        <div class="dropdown dropdown-end" sec:authorize="isAuthenticated()">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle">
                <div class="indicator">
                    <i data-lucide="shopping-cart" class="h-5 w-5"></i>
                    <span th:if="${cartItemCount > 0}"
                          th:text="${cartItemCount}"
                          class="badge badge-sm indicator-item badge-primary">
                    </span>
                </div>
            </div>
            <div tabindex="0" class="mt-3 z-[1] card card-compact dropdown-content w-52 bg-base-100 shadow">
                <div class="card-body">
                    <span class="font-bold text-lg">장바구니</span>
                    <span class="text-info">상품이 담겨있습니다</span>
                    <div class="card-actions">
                        <a href="/cart" class="btn btn-primary btn-block">장바구니 보기</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- User Menu (Guest) -->
        <div sec:authorize="isAnonymous()" class="flex items-center gap-2 ml-4">
            <a href="/login" class="btn btn-outline btn-sm">로그인</a>
            <a href="/register" class="btn btn-primary btn-sm">회원가입</a>
        </div>

        <!-- User Menu (Logged in) -->
        <div sec:authorize="isAuthenticated()" class="dropdown dropdown-end ml-4">
            <div tabindex="0" role="button" class="btn btn-ghost btn-circle avatar">
                <div class="w-10 rounded-full">
                    <img th:id="profileImage"
                         th:src="${#authentication.principal.profileUrl != null ? #authentication.principal.profileUrl : '/default_profile.jpeg'}"
                         alt="프로필 사진" />
                </div>
            </div>
            <ul tabindex="0" class="menu menu-sm dropdown-content mt-3 z-[1] p-2 shadow bg-base-100 rounded-box w-52">
                <li>
                    <a class="justify-between">
                        <span sec:authentication="principal.member.name">사용자</span>님
                    </a>
                </li>
                <li><a href="/profile">프로필</a></li>
                <li><a href="/orders">주문 내역</a></li>
                <li><a href="/wishlist">위시리스트</a></li>
                
                <!-- Admin Menu -->
                <div sec:authorize="hasRole('ADMIN')">
                    <li><div class="divider"></div></li>
                    <li>
                        <a href="/products/create" class="text-info">
                            <i data-lucide="plus" class="h-4 w-4"></i>
                            상품 등록
                        </a>
                    </li>
                    <li>
                        <a href="/admin/products" class="text-info">
                            <i data-lucide="package" class="h-4 w-4"></i>
                            상품 관리
                        </a>
                    </li>
                </div>
                
                <li><div class="divider"></div></li>
                <li><a href="/logout" class="text-error">로그아웃</a></li>
            </ul>
        </div>
    </div>
</nav>
</body>
</html>
